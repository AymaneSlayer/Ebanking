<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Language" content="fr">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Dashboard E-Banking Adria</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
    <meta name="description" content="Dashboard de gestion bancaire Adria">
    <meta name="msapplication-tap-highlight" content="no">
    
    <!-- CSS Links -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    
</head>

<body>
    <div class="app-container">
         {% include 'sidebar.html' %}

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- HEADER -->
            <div class="app-header">
                <div class="app-header__content">
                    <div class="app-header-left">
                        <h4 class="mb-0">Aymane Falaki</h4>

                    </div>
                    
                </div>
            </div>

            <!-- TITLE -->
            <div class="page-title-wrapper">
                <div class="page-title-heading">
                    <div>Dashboard</div>
                </div>
            </div>

            <!-- SUMMARY CARDS -->
            <div class="row">
                <div class="col-md-6 col-xl-3">
                    <div class="widget-card bg-deposits">
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left">
                                <div class="widget-heading">Dépôts</div>
                                <div class="widget-subheading">Total ce mois</div>
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers" id="total-deposits">245,500 DH</div>
                                <i class="bi bi-arrow-down-circle widget-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="widget-card bg-withdrawals">
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left">
                                <div class="widget-heading">Retraits</div>
                                <div class="widget-subheading">Total ce mois</div>
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers" id="total-withdrawals">128,750 DH</div>
                                <i class="bi bi-arrow-up-circle widget-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="widget-card bg-transfers">
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left">
                                <div class="widget-heading">Virements</div>
                                <div class="widget-subheading">Total ce mois</div>
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers" id="total-transfers">89,320 DH</div>
                                <i class="bi bi-arrow-left-right widget-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-xl-3">
                    <div class="widget-card bg-balance">
                        <div class="widget-content-wrapper">
                            <div class="widget-content-left">
                                <div class="widget-heading">Solde Total</div>
                                <div class="widget-subheading">Tous comptes</div>
                            </div>
                            <div class="widget-content-right">
                                <div class="widget-numbers" id="total-balance">1,256,480 DH</div>
                                <i class="bi bi-wallet2 widget-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

           <!-- CHARTS ROW -->
<div class="row">
    <div class="col-md-12">
        <div class="chart-container">
            <div class="chart-header">
                <div class="chart-title">
                    <i class="bi bi-pie-chart"></i>
                    Répartition par Type
                </div>
            </div>
            <div class="chart-body">
                <canvas id="typesPieChart" height="150"></canvas>
            </div>
        </div>
    </div>
</div>
            <!-- RECENT TRANSACTIONS TABLE -->
            <div class="row">
                <div class="col-md-12">
                    <div class="table-container">
                        <div class="chart-header">
                            <div class="chart-title">
                                <i class="bi bi-clock-history"></i>
                                Dernières Transactions
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Compte</th>
                                        <th>Type</th>
                                        <th>Montant</th>
                                        <th>Date</th>
                                        <th>Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="recent-transactions">
    {% for op in recent_ops %}
    <tr>
        <td><strong>#{{ "%03d" | format(op.id) }}</strong></td>
        <td>{{ op.compte }}</td>
        <td>
            <span class="transaction-type type-{{ op.type|lower }}">
                {{ op.type }}
            </span>
        </td>
        <td>
            <span class="transaction-amount {% if op.type == 'Dépôt' %}amount-positive{% else %}amount-negative{% endif %}">
                {% if op.type == 'Dépôt' %}+{% else %}-{% endif %}{{ "{:,.2f}".format(op.montant) }} DH
            </span>
        </td>
        <td>{{ op.date.strftime("%d/%m/%Y") }}</td>
        <td><span class="badge bg-success">Validé</span></td>
    </tr>
    {% endfor %}
</tbody>

                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MONTHLY VOLUME CHART -->
            <div class="row">
                <div class="col-md-12">
                    <div class="chart-container">
                        <div class="chart-header">
                            <div class="chart-title">
                                <i class="bi bi-graph-up"></i>
                                Volume des Transactions par Mois
                            </div>
                        </div>
                        <div class="chart-body">
                            <canvas id="monthlyVolumeChart" height="80"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        
        // Graphique en secteurs des types d'opérations
        const pieCtx = document.getElementById('typesPieChart').getContext('2d');
        new Chart(pieCtx, {
            type: 'doughnut',
            data: {
                labels: ['Dépôts', 'Retraits', 'Virements'],
                datasets: [{
                    data: [245500, 128750, 89320],
                    backgroundColor: [
                        '#667eea',
                        '#f5576c',
                        '#4facfe'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });

        // Graphique mensuel avec données réelles
        const monthlyCtx = document.getElementById('monthlyVolumeChart').getContext('2d');
        new Chart(monthlyCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû'],
                datasets: [{
                    label: 'Volume Total (DH)',
                    data: [1250000, 1350000, 1180000, 1420000, 1380000, 1290000, 1460000, 1520000],
                    backgroundColor: 'rgba(30, 60, 114, 0.8)',
                    borderColor: '#1e3c72',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return (value / 1000000).toFixed(1) + 'M DH';
                            }
                        }
                    }
                }
            }
        });

        // Animation des compteurs
        function animateCounter(elementId, targetValue, suffix = ' DH') {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            let currentValue = 0;
            const increment = targetValue / 100;
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(currentValue).toLocaleString() + suffix;
            }, 20);
        }

        // Animer les compteurs au chargement
        window.addEventListener('load', () => {
            setTimeout(() => {
                animateCounter('total-deposits', 245500);
                animateCounter('total-withdrawals', 128750);
                animateCounter('total-transfers', 89320);
                animateCounter('total-balance', 1256480);
            }, 500);
        });
    </script>
</body>
</html>